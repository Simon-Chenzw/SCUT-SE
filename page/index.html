<!doctype html>
<html lang="zh-cn">


<head>
    <link rel="stylesheet" type="text/css" href="main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.x/css/all.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
</head>

<body>

    <div id="app">
        <v-app>
            <header>
                <v-toolbar>
                    <v-row>

                        <v-col cols='2'>
                            <v-btn icon href='/'>
                                <v-icon>fa-home</v-icon>
                            </v-btn>
                        </v-col>

                        <v-col cols="8">
                            <template>
                                <div v-on:keyup.enter="search">
                                    <v-menu offset-y>
                                        <template v-slot:activator="{ on }">
                                            <v-text-field solo hide-details label="请输入关键词" append-icon="search"
                                                v-model="text" class="input-search" autocomplete="off" v-on="on"
                                                ref="search"></v-text-field>
                                        </template>
                                        <v-list rounded v-if="results.length > 0" class="border-list" dense>
                                            <v-list-item v-for="(result, index) in results" :key="index"
                                                @click="resultClick(result)">
                                                <v-list-item-title>{{ result.name }}</v-list-item-title>
                                            </v-list-item>
                                        </v-list>
                                    </v-menu>
                                </div>
                            </template>
                        </v-col>

                        <v-col cols='2' class="text-right">

                            <template v-if='self_user_info'>

                                <v-btn icon>
                                    <v-icon>fa-user</v-icon>
                                </v-btn>

                                {{self_user_info.name}}

                                <v-btn v-on:click='logout'> logout </v-btn>


                            </template>

                            <template v-else>

                                <v-btn icon>
                                    <v-icon>fa-user-slash</v-icon>
                                </v-btn>

                                <v-btn href='/login.html'> login </v-btn>

                            </template>

                        </v-col>

                    </v-row>
                </v-toolbar>
            </header>


        </v-app>
    </div>
</body>

<script>

    new Vue({
        el: '#app',
        vuetify: new Vuetify(),
        data() {
            return {
                self_user_info: undefined,
                text: '',
                showSelect: true,
                results: []
            }
        },
        mounted() {
            this.user_info()
        },
        watch: {
            text: 'inputHandle'
        },
        methods: {
            user_info(uid) {
                url = uid ? "/api/user/info?uid=" + toString(uid) : "/api/user/info"
                axios.get(url).then(
                    (resp) => this.self_user_info = resp.data
                ).catch(
                    (err) => this.self_user_info = undefined
                )
            },
            logout() {
                axios.get("/api/user/logout").then(
                    (resp) => this.user_info()
                )
            },
            resultClick(result) {
                this.text = result.name
                this.$refs.search.blur()
            },
            inputHandle(text) {
                if (text.trim() !== '') {
                    this.showSelect = true
                    setTimeout(() => {
                        this.getEntity()
                    }, 300)
                }
            },
            getEntity() {
                // API
                this.results = [
                    {
                        key: '1234',
                        name: '1234'
                    },
                    {
                        key: 'abc',
                        name: 'abc'
                    },
                    {
                        key: 'def',
                        name: 'def'
                    },
                    {
                        key: 'ccc',
                        name: 'ccc'
                    },
                    {
                        key: 'ccc',
                        name: 'ccc'
                    },
                    {
                        key: 'ccc',
                        name: 'ccc'
                    }
                ]
            },
            search() {
                // TODO: page skip
                window.open('https://www.baidu.com');
                this.$refs.search.blur()
                console.log(this.text)
            },
        }
    })
</script>

</html>