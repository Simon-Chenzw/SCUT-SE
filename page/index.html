<!doctype html>
<html lang="zh-cn">


<head>
    <link rel="stylesheet" type="text/css" href="main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.x/css/all.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>

    <script type="text/javascript" src="iview.min.js"></script>
</head>

<body>

    <v-app>
        <div id="app">
            <header class="flex-1-1-auto d-flex align-center justify-end">
                <Affix>

                    <v-toolbar class="demo-affix">
                        <v-row>

                            <v-col cols='2' class="header-icon">
                                <v-btn icon href='/'>
                                    <v-icon>fa-home</v-icon>
                                </v-btn>
                            </v-col>

                            <v-col cols="8" class="search-bar">
                                <template>
                                    <v-form>
                                        <v-continer>
                                            <v-text-field v-model="search_msg" v-on:keyup.enter="search">
                                                <template v-slot:label>
                                                    What do you wanna know?
                                                </template>
                                                <v-icon slot="append" @click="search" color="blue">
                                                    fa-search
                                                </v-icon>
                                            </v-text-field>
                                        </v-continer>
                                    </v-form>
                                </template>
                            </v-col>

                            <v-col cols='2' class="text-right header-icon">

                                <template v-if='self_user_info'>

                                    <v-btn icon>
                                        <v-icon>fa-user</v-icon>
                                    </v-btn>

                                    {{self_user_info.name}}

                                    <v-btn v-on:click='logout'> logout </v-btn>


                                </template>

                                <template v-else>

                                    <v-btn icon>
                                        <v-icon>fa-user-slash</v-icon>
                                    </v-btn>

                                    <v-btn href='/login.html'> login </v-btn>

                                </template>

                            </v-col>

                        </v-row>
                    </v-toolbar>

                </Affix>
            </header>
        </div>
    </v-app>

    <div id="card">
        <v-container fill-height fluid>
            <v-row justify="center">
                <v-col cols='2'></v-col>


                <v-col cols='6'>
                    <template>
                        <v-card class="mx-auto" v-for="data in datas">

                            <v-card-title>
                                {{data.question}}
                            </v-card-title>

                            <v-card-subtitle>
                                {{data.description}}
                            </v-card-subtitle>

                            <v-card-actions>
                                <v-btn text color="orange lighten-2" @click="agree">
                                    Agree
                                </v-btn>

                                <v-btn text color="orange lighten-2" @click="disagree">
                                    Disagree
                                </v-btn>

                                <v-spacer></v-spacer>

                                <v-btn icon @click="data.show = !data.show">
                                    <v-icon>{{ data.show ? 'mdi-chevron-up' : 'mdi-chevron-down' }}</v-icon>
                                </v-btn>
                            </v-card-actions>

                            <v-expand-transition>
                                <div v-show="data.show">
                                    <v-divider></v-divider>

                                    <v-card-text>
                                        {{data.answer}}
                                    </v-card-text>
                                </div>
                            </v-expand-transition>
                        </v-card>
                    </template>
                </v-col>

                <v-col cols='2'>
                    <template>
                        <v-carousel :show-arrows="false">
                            <v-carousel-item v-for="(photo,i) in photos" :key="i" :src="photo.src"></v-carousel-item>
                        </v-carousel>
                    </template>
                </v-col>

                <v-col cols='2'></v-col>
            </v-row>
        </v-container>

    </div>


</body>

<script>

    new Vue({
        el: '#app',
        vuetify: new Vuetify(),
        data() {
            return {
                self_user_info: undefined,
                text: '',
                showSelect: true,
                results: [],
                search_msg: '',
                value
            }
        },
        mounted() {
            this.user_info()
        },
        methods: {
            user_info(uid) {
                url = uid ? "/api/user/info?uid=" + toString(uid) : "/api/user/info"
                axios.get(url).then(
                    (resp) => this.self_user_info = resp.data
                ).catch(
                    (err) => this.self_user_info = undefined
                )
            },
            logout() {
                axios.get("/api/user/logout").then(
                    (resp) => this.user_info()
                )
            },
            search() {
                // TODO: page skip
                window.open('https://www.baidu.com/s?wd=' + this.search_msg);
                this.$refs.search.blur()
                console.log(this.text)
            },
        }
    })


    new Vue({
        el: '#card',
        vuetify: new Vuetify(),
        data: () => ({
            show: false,
            photos: [
                {
                    src: 'https://cdn.vuetifyjs.com/images/carousel/squirrel.jpg',
                },
                {
                    src: 'https://cdn.vuetifyjs.com/images/carousel/sky.jpg',
                },
                {
                    src: 'https://cdn.vuetifyjs.com/images/carousel/bird.jpg',
                },
                {
                    src: 'https://cdn.vuetifyjs.com/images/carousel/planet.jpg',
                },
            ],
            datas: [
                {
                    question: "1+1=?",
                    description: "I Don't know",
                    answer: "2",
                    show: false,
                },
                {
                    question: "2+1=?",
                    description: "I Don't know",
                    answer: "3",
                    show: false,
                },
                {
                    question: "3+1=?",
                    description: "I Don't know",
                    answer: "4",
                    show: false,
                },
                {
                    question: "4+1=?",
                    description: "I Don't know",
                    answer: "5",
                    show: false,
                },
                {
                    question: "5+1=?",
                    description: "I Don't know",
                    answer: "6",
                    show: false,
                },
                {
                    question: "6+1=?",
                    description: "I Don't know",
                    answer: "7",
                    show: false,
                },
            ]
        }),
        mounted() {
            addEventListener('scroll', this.handleScroll)//监听函数
        },
        methods: {
            agree() {
                window.alert("yes");
            },
            disagree() {
                window.alert("No");
            },
            handleScroll() {
                let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                let windowHeight = document.documentElement.clientHeight || document.body.clientHeight;
                let scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
                console.log(scrollTop, windowHeight, scrollHeight);
                // debugger;
                if (scrollTop + windowHeight >= scrollHeight - 100) {
                    // window.alert("end");
                    this.datas.push({
                        question: "2+1=?",
                        description: "I Don't know",
                        answer: "3",
                        show: false,
                    });
                    console.log(this.datas);
                }
            }
        },
        destroyed() {
            window.removeEventListener('scroll', this.handleScroll)
        }
    })
</script>

</html>